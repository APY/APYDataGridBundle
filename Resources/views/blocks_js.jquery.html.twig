{% extends 'APYDataGridBundle::blocks.html.twig' %}

{% block grid_scripts_goto %}
function {{ grid.hash }}_goto(url, data, type)
{
    type = type || 'GET';
    data = data || [];
    $('#{{ grid.hash }}').parent().fadeTo("slow", 0.5);
    
    jQuery.ajax({
			type: type,
			dataType : 'html',
			data: data,
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(XMLHttpRequest.responseText);
			},
			complete : function(XMLHttpRequest, textStatus) {
			     $('#{{ grid.hash }}').parent().fadeTo("slow", 1);
			},
			success : function(data, textStatus) {
				$('#{{ grid.hash }}').parent().replaceWith(data);
				{{ grid.hash }}_initGridEvents(url);
			},
			url : url
		});

   
    return false;
}
{% endblock grid_scripts_goto %}

{% block grid_scripts_submit_form %}
function {{ grid.hash }}_submitForm(event, form, force)
{
    if (force || event.which == 13) {
        var data = '';
        $('.grid-filter-operator select, .grid-filter-input-query-from, .grid-filter-input-query-to, .grid-filter-select-query-from, .grid-filter-select-query-to', form).each(function () {
            if ($(this).is(':disabled') == false) {
                var value = $(this).val() == null ? '' : $(this).val();
                data += '&' + $(this).attr('name') + '=' + value;
            }
        });

        {{ grid.hash }}_goto('{{ grid.routeUrl }}', data.substring(1), 'POST');

        return false;
    }
}
{% endblock grid_scripts_submit_form %}

{% block grid_scripts_ajax %}
function {{ grid.hash }}_initGridEvents(routeurl) {
    // Order and pagerfanta links
    $('a.order, nav a, .pagination a', '#{{ grid.hash }}').click(function () {
        {{ grid.hash }}_goto(this.href);

        return false;
    });

    // Reset link
    $('#{{ grid.hash }} a.grid-reset').click(function () {
        {{ grid.hash }}_reset();

        return false;
    });

    // Mass actions submit
    $('#{{ grid.hash }} input.submit-massaction').click(function () {
        var selector = $('#{{ grid.hash }} .grid_massactions select');

        {{ grid.hash }}_goto('{{ grid.routeUrl }}', selector.attr('name') + '=' + selector.val(), 'POST');

        return false;
    });

    // Grid_search submit (load only one time)
    $('#{{ grid.hash }}_search').one('submit', function (event) {
        {{ grid.hash }}_submitForm(event, this, true);

        return false;
    });
};

$(document).ready(function() {
    {{ grid.hash }}_initGridEvents('{{ grid.routeUrl }}');
});
{% endblock grid_scripts_ajax %}
